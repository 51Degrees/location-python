# Template to install all the pre-requisites and to upload packages on specified feed.

parameters:
# publishEndpoint parameter takes the feed name, 
# where package is to be uploaded.
- name: publishEndpoint

steps:
# Autuntication step for internal feed only.
- task: TwineAuthenticate@1
  displayName: 'Twine Authenticate Internal Feed'
  inputs:
    artifactFeed: 'pipeline-insider'
  condition: eq('${{ parameters.publishEndpoint }}', 'pipeline-insider')

- task: TwineAuthenticate@1
# Autuntication step for public feeds.
  displayName: 'TestPyPI Twine Authenticate External Feed'
  inputs:
    pythonUploadServiceConnection: PyPITestAuthentication
  condition: ne('${{ parameters.publishEndpoint }}', 'pipeline-insider')
              
- task: UsePythonVersion@0
  displayName: 'Use Python $(pythonVersionDefault)'
  inputs:
    versionSpec: $(pythonVersionDefault)
  
- bash: |
     python -m pip install --upgrade pip
     pip install twine
  failOnStderr: true
  displayName: 'Install Twine'             

# Upload packages
- template: shared-upload-packages.yml
  parameters:
    publishEndpoint: ${{ parameters.publishEndpoint }}
    packageName: 'location-python'   